.TH bup-restore 1 "2013\[en]07\[en]31" "Bup 0.25-rc2"
.SH NAME
.PP
bup-restore - extract files from a backup set
.SH SYNOPSIS
.PP
bup restore [--outdir=\f[I]outdir\f[]] [--exclude-rx \f[I]pattern\f[]]
[-v] [-q] <paths...>
.SH DESCRIPTION
.PP
\f[C]bup\ restore\f[] extracts files from a backup set (created with
\f[C]bup-save\f[](1)) to the local filesystem.
.PP
The specified \f[I]paths\f[] are of the form
/\f[I]branch\f[]/\f[I]revision\f[]/\f[I]some/where\f[].
The components of the path are as follows:
.TP
.B branch
the name of the backup set to restore from; this corresponds to the
\f[C]--name\f[] (\f[C]-n\f[]) option to \f[C]bup\ save\f[].
.RS
.RE
.TP
.B revision
the revision of the backup set to restore.
The revision \f[I]latest\f[] is always the most recent backup on the
given branch.
You can discover other revisions using \f[C]bup\ ls\ /branch\f[].
.RS
.RE
.TP
.B some/where
the previously saved path (after any stripping/grafting) that you want
to restore.
For example, \f[C]etc/passwd\f[].
.RS
.RE
.PP
If \f[I]some/where\f[] names a directory, \f[C]bup\ restore\f[] will
restore that directory and then recursively restore its contents.
.PP
If \f[I]some/where\f[] names a directory and ends with a slash (ie.
path/to/dir/), \f[C]bup\ restore\f[] will restore the children of that
directory directly to the current directory (or the \f[C]--outdir\f[]).
If \f[I]some/where\f[] does not end in a slash, the children will be
restored to a subdirectory of the current directory.
.PP
If \f[I]some/where\f[] names a directory and ends in \[aq]/.\[aq] (ie.
path/to/dir/.)
, \f[C]bup\ restore\f[] will do exactly what it would have done for
path/to/dir, and then restore \f[I]dir\f[]\[aq]s metadata to the current
directory (or the \f[C]--outdir\f[]).
See the EXAMPLES section.
.PP
Whenever path metadata is available, \f[C]bup\ restore\f[] will attempt
to restore it.
When restoring ownership, bup implements tar/rsync-like semantics.
It will not try to restore the user unless running as root, and it will
fall back to the numeric uid or gid whenever the metadata contains a
user or group name that doesn\[aq]t exist on the current system.
The use of user and group names can be disabled via
\f[C]--numeric-ids\f[] (which can be important when restoring a chroot,
for example), and as a special case, a uid or gid of 0 will never be
remapped by name.
.PP
Hardlinks will also be restored when possible, but at least currently,
no links will be made to targets outside the restore tree, and if the
restore tree spans a different arrangement of filesystems from the save
tree, some hardlink sets may not be completely restored.
.PP
Also note that changing hardlink sets on disk between index and save may
produce unexpected results.
With the current implementation, bup will attempt to recreate any given
hardlink set as it existed at index time, even if all of the files in
the set weren\[aq]t still hardlinked (but were otherwise identical) at
save time.
.PP
Note that during the restoration process, access to data within the
restore tree may be more permissive than it was in the original source.
Unless security is irrelevant, you must restore to a private
subdirectory, and then move the resulting tree to its final position.
See the EXAMPLES section for a demonstration.
.SH OPTIONS
.TP
.B -C, --outdir=\f[I]outdir\f[]
create and change to directory \f[I]outdir\f[] before extracting the
files.
.RS
.RE
.TP
.B --numeric-ids
restore numeric IDs (user, group, etc.)
 rather than names.
.RS
.RE
.TP
.B --exclude-rx=\f[I]pattern\f[]
exclude any path matching \f[I]pattern\f[], which must be a Python
regular expression (http://docs.python.org/library/re.html).
The pattern will be compared against the full path rooted at the top of
the restore tree, without anchoring, so "x/y" will match "ox/yard" or
"box/yards".
To exclude the contents of /tmp, but not the directory itself, use
"^/tmp/.".
(can be specified more than once)
.RS
.PP
Note that the root of the restore tree (which matches \[aq]^/\[aq]) is
the top of the archive tree being restored, and has nothing to do with
the filesystem destination.
Given "restore ...
/foo/latest/etc/", the pattern \[aq]^/passwd$\[aq] would match if a file
named passwd had been saved as \[aq]/foo/latest/etc/passwd\[aq].
.PP
Examples:
.IP \[bu] 2
\[aq]/foo$\[aq] - exclude any file named foo
.IP \[bu] 2
\[aq]/foo/$\[aq] - exclude any directory named foo
.IP \[bu] 2
\[aq]/foo/.\[aq] - exclude the content of any directory named foo
.IP \[bu] 2
\[aq]^/tmp/.\[aq] - exclude root-level /tmp\[aq]s content, but not /tmp
itself
.RE
.TP
.B -v, --verbose
increase log output.
Given once, prints every directory as it is restored; given twice,
prints every file and directory.
.RS
.RE
.TP
.B -q, --quiet
don\[aq]t show the progress meter.
Normally, is stderr is a tty, a progress display is printed that shows
the total number of files restored.
.RS
.RE
.SH EXAMPLE
.PP
Create a simple test backup set:
.IP
.nf
\f[C]
$\ bup\ index\ -u\ /etc
$\ bup\ save\ -n\ mybackup\ /etc/passwd\ /etc/profile
\f[]
.fi
.PP
Restore just one file:
.IP
.nf
\f[C]
$\ bup\ restore\ /mybackup/latest/etc/passwd
Restoring:\ 1,\ done.

$\ ls\ -l\ passwd
-rw-r--r--\ 1\ apenwarr\ apenwarr\ 1478\ 2010-09-08\ 03:06\ passwd
\f[]
.fi
.PP
Restore etc to test (no trailing slash):
.IP
.nf
\f[C]
$\ bup\ restore\ -C\ test\ /mybackup/latest/etc
Restoring:\ 3,\ done.

$\ find\ test
test
test/etc
test/etc/passwd
test/etc/profile
\f[]
.fi
.PP
Restore the contents of etc to test (trailing slash):
.IP
.nf
\f[C]
$\ bup\ restore\ -C\ test\ /mybackup/latest/etc/
Restoring:\ 2,\ done.

$\ find\ test
test
test/passwd
test/profile
\f[]
.fi
.PP
Restore the contents of etc and etc\[aq]s metadata to test (trailing
"/."):
.IP
.nf
\f[C]
$\ bup\ restore\ -C\ test\ /mybackup/latest/etc/.
Restoring:\ 2,\ done.

#\ At\ this\ point\ test\ and\ etc\[aq]s\ metadata\ will\ match.
$\ find\ test
test
test/passwd
test/profile
\f[]
.fi
.PP
Restore a tree without risk of unauthorized access:
.IP
.nf
\f[C]
#\ mkdir\ --mode\ 0700\ restore-tmp

#\ bup\ restore\ -C\ restore-tmp\ /somebackup/latest/foo
Restoring:\ 42,\ done.

#\ mv\ restore-tmp/foo\ somewhere

#\ rmdir\ restore-tmp
\f[]
.fi
.SH SEE ALSO
.PP
\f[C]bup-save\f[](1), \f[C]bup-ftp\f[](1), \f[C]bup-fuse\f[](1),
\f[C]bup-web\f[](1)
.SH BUP
.PP
Part of the \f[C]bup\f[](1) suite.
.SH AUTHORS
Avery Pennarun <apenwarr@gmail.com>.
